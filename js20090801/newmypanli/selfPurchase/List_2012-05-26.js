function upLogistics(b,a,c,e){var d=ArrayToJSON(b);$.ajax({type:"POST",url:"/App_Services/wsSelfPurchase.asmx/UpLogistics",cache:false,dataType:"json",contentType:"application/json;utf-8",data:'{"IDs":'+d+',"company":"'+a+'","package":"'+c+'"}',timeout:10000,error:function(){alert("网络错误，请稍后再试");},success:e});}function ArrayToJSON(a){var c="[";for(var b=0;b<a.length;b++){c+=a[b]+",";}c=c.substring(0,c.lastIndexOf(",",c.length))+"]";return c;}function openCSPanel(b,a){window.Panli.overlay.open();$("#CSPanel :text,#scsContent").removeClass("advisory_red").val("");$("#CSPanel").data("id",b).show();$("#scsCompany").val($(a).parents("tr").find(".wlcompany").val());$("#scsCode").val($(a).parents("tr").find(".wlpackage").val());$("#scsEmail").val($("#userEmail").val());}function scsError(a,b){$(b).addClass("advisory_red").val(a);}$(function(){$(".wlcompany,.wlpackage").focus(function(){if($(this).attr("class").indexOf("hong")>0){$(this).removeClass("hong").val("");}});$(".tianxie,.wan","#ListPanel").hover(function(){$(this).addClass("dd").next("div").show();},function(){$(this).removeClass("dd").next("div").hide();});$(".wl","#ListPanel").hover(function(){$(this).show().prev("a").addClass("dd");},function(){$(this).hide().prev("a").removeClass("dd");});$(".wlCancel").click(function(){$(this).parents(".wl").hide().prev("a").removeClass("dd");return false;});$(".wlSubmit").click(function(){$c=$(this).prev("ul").find(".wlcompany");$p=$(this).prev("ul").find(".wlpackage");if($.trim($c.val()).length<=0){$c.addClass("hong").val("请填写物流公司");}if($.trim($p.val()).length<=0){$p.addClass("hong").val("请填写运单号码");}if($(this).prev("ul").find(".hong").length>0){return false;}var b=[];b.push($(this).parents("tr").find(":checkbox").val());upLogistics(b,$c.val(),$p.val(),function(c){if(c.d=="success"){window.Panli.Message.show("物流信息修改成功");$(this).parents(".wl").hide().prev("a").removeClass("dd");}return false;});return false;});$("#delBtn").click(function(){if($(".gl1 :checked").length<=0){alert("请勾选您要删除的商品！");return false;}if(!confirm("您确定要删除这些商品吗？")){return false;}var b=[];$(".gl1 :checked").each(function(c,e){b.push($(e).val());});$.ajax({type:"POST",url:"/App_Services/wsSelfPurchase.asmx/DelProducts",cache:false,dataType:"json",beforeSend:function(){$("#delBtn").attr("disabled","disabled");},complete:function(){$("#delBtn").removeAttr("disabled");},contentType:"application/json;utf-8",data:'{"IDs":'+ArrayToJSON(b)+"}",timeout:10000,error:function(){alert("网络错误，请稍后再试");},success:function(c){if(c.d=="success"){$(".gl1 :checked").each(function(e,f){$(f).parents("tr").fadeOut(800,function(){$(this).remove();$("#ListPanel table").each(function(g,h){if($(":checkbox",$(h)).length<=0){$(h).remove();}});if($("#ListPanel table").length<=0){$("#ListPanel").html('<div class="gl_wu"><h2>如果您已经开始使用Panli自助购服务，记得赶紧<a href="/mypanli/selfPurchase/Order.aspx">提交自助购</a>商品清单喔！</h2><p><a href="/mypanli/SelfPurchase/Wizard.aspx" target="new">什么是Panli自助购服务？</a></p></div>');}});});}}});return false;});$("#wlBtn").click(function(){if($(".gl1 :checked").length<=0){alert("请勾选同一包裹内的商品");return false;}var b="";$(".gl1 :checked").each(function(c,e){b=b+($(e).parents("tr").find(".wlpackage").hasClass("hong")?"":$(e).parents("tr").find(".wlpackage").val());b=b+($(e).parents("tr").find(".wlcompany").hasClass("hong")?"":$(e).parents("tr").find(".wlcompany").val());});if($.trim(b).length>0){if(!confirm("您选中的商品中部分已有物流信息，是否要进行修改？")){return false;}}$("#wlOverlay,#wlEditPanel").show();return false;});$("#wlpCom,#wlpPak").focus(function(){if($(this).hasClass("hong")){$(this).removeClass("hong").val("");}});$("#wlpSubmit").click(function(){var b=$("#wlpCom").val();var d=$("#wlpPak").val();if(b.length<=0){$("#wlpCom").addClass("hong").val("请填写物流公司");}if(d.length<=0){$("#wlpPak").addClass("hong").val("请填写运单号码");}if($("#wlEditPanel .hong").length>0){return false;}var c=[];$(".gl1 :checked").each(function(e,f){c.push($(f).val());});upLogistics(c,b,d,function(e){if(e.d=="success"){$("#wlpCom,#wlpPak").val("");$("#wlEditPanel,#wlOverlay,#wlEditPanel").hide();window.Panli.Message.show("物流信息修改成功");$(".gl1 :checked").each(function(f,g){var h=$(g).parents("tr");h.find(".wlcompany").val(b);h.find(".wlpackage").val(d);this.checked=false;});}});return false;});$("#wlpCancel,#wlpClose").click(function(){$("#wlEditPanel").fadeOut(500,function(){$("#wlOverlay,#wlEditPanel").hide();});return false;});var a=$('<div class="bz_dw"><div class="beizhu"><div style="width: 270px; float: left;"><textarea id="spRemarkInput" cols="" rows=""></textarea><dl><dt><input class="EditRemarkBtn" type="button" value="修改" /></dt><dd><input class="CloseBtn" type="button" value="关闭" /></dd></dl></div><img src="http://sf.panli.com/FrontEnd/images20090801/newmypanli/jiantou.gif" alt="" /></div></div>');$("textarea",a).focus(function(){if($(this).hasClass("red")){$(this).removeClass("red").val("");}});$(".CloseBtn",a).click(function(){a.close();return false;});a.click(function(b){b.stopPropagation();});a.open=function(b){a.detach();$(b).after(a);$("textarea",a).removeClass("red");a.find(".beizhu").css({width:"0px",left:"-60px"}).animate({width:"280px",left:"-340px"});$("#spRemarkInput").val($(b).nextAll("input").val());};a.close=function(){a.find(".beizhu").animate({width:"0px",left:"-60px"},function(){a.detach();});};a.toggle=function(b){a.stop(true,true);$(b).nextAll().length>1?a.close():a.open(b);};$(".EditRemarkBtn",a).click(function(){var d=$(this);var c=d.parents(".bz_dw").next("input").val();var b=$.trim($("#spRemarkInput").val());if(b.length<=0){$("textarea",a).val("请填写商品备注").addClass("red");return false;}if(b==c){a.close();return false;}$.ajax({type:"POST",url:"/App_Services/wsSelfPurchase.asmx/UpRemarkWithId",cache:false,dataType:"json",beforeSend:function(){$(this).attr("disabled","disabled");},complete:function(){$(this).removeAttr("disabled");},contentType:"application/json;utf-8",data:'{"id":'+$(this).parents("tr").find(":checkbox").val()+',"remark":"'+b+'"}',timeout:10000,error:function(){alert("网络错误，请稍后再试");},success:function(e){if(e.d=="success"){d.parents(".bz_dw").next("input").val(b);a.close();}}});return false;});$(".spRemark").click(function(b){a.toggle(this);b.stopPropagation();return false;});$("#cscontent").keyup(function(){var b=$.trim($("#cscontent").val());if(b.length>1000){$("#cscontent").val(b.substring(0,1000));}});$("#CSPanel :text,#scsContent").focus(function(){if($(this).hasClass("advisory_red")){$(this).removeClass("advisory_red").val("");}});$("#selfCSbtn").click(function(){var c=$.trim($("#scsEmail").val());var b=$.trim($("#scsCompany").val());var f=$.trim($("#scsCode").val());var e=$.trim($("#scsContent").val());if($("#CSPanel .advisory_red").length>0){return false;}if(c.length<=0){scsError("请填写您的常用邮箱！",$("#scsEmail"));return false;}var d=new RegExp("\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*");if(!d.test(c)){scsError("您的Email格式有误！",$("#scsEmail"));return false;}if(b.length<=0){scsError("请填写物流公司名！",$("#scsCompany"));return false;}if(f.length<=0){scsError("请填写运单号码！",$("#scsCode"));return false;}if(e.length<=0){scsError("请填写咨询问题详情！",$("#scsContent").replace(/\\/g,"\\\\").replace(/"/g,'\\"'));return false;}$.ajax({type:"POST",url:"/App_Services/wsSelfPurchase.asmx/CService",cache:false,dataType:"json",contentType:"application/json;utf-8",data:'{"id":'+$("#CSPanel").data("id")+',"email":"'+c+'","company":"'+b+'","code":"'+f+'","content":"'+e.replace(/\\/g,"\\").replace(/"/g,'"')+'"}',timeout:10000,beforeSend:function(){$("#selfCSbtn").attr("disabled","disabled");},complete:function(){$("#selfCSbtn").removeAttr("disabled");},error:function(){alert("网络错误，请稍后再试");},success:function(g){alert("您的问题已成功提交，我们将在1-2个工作日内回馈至您的邮箱，请耐心等待。");$("#CSPanel").hide();window.Panli.overlay.close();$("#CSPanel :text,#scsContent").val("");return false;}});});$(document).click(function(){a.close();});});